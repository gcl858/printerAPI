<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>00I001 å‰µä½œ ğŸŒ Banana - </title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg'>ğŸŒ</svg>">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-card: #ffffff;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --accent-primary: #3b82f6;
            --accent-secondary: #8b5cf6;
            --border-radius: 16px;
            --shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
            color: var(--text-primary);
            min-height: 100vh;
        }

        .main-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1);
        }

        .title-gradient {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 700;
        }

        .card-custom {
            background: var(--bg-card);
            border: 1px solid rgba(0, 0, 0, 0.08);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow);
            backdrop-filter: blur(20px);
        }

        .upload-zone {
            border: 2px dashed #cbd5e1;
            border-radius: var(--border-radius);
            background: var(--bg-secondary);
            transition: all 0.3s ease;
            cursor: pointer;
            min-height: 200px;
        }

        .upload-zone:hover,
        .upload-zone.drag-over {
            border-color: var(--accent-primary);
            background: rgba(59, 130, 246, 0.05);
        }

        .btn-generate {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            border-radius: var(--border-radius);
            font-weight: 600;
            padding: 12px 30px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn-generate:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 35px rgba(59, 130, 246, 0.3);
        }

        .btn-generate:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .result-container {
            background: var(--bg-card);
            border-radius: var(--border-radius);
            min-height: 400px;
        }

        .result-container img {
            border-radius: var(--border-radius);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .spinner-border-custom {
            width: 1.5rem;
            height: 1.5rem;
            border-width: 2px;
        }

        .alert-custom {
            border: none;
            border-radius: var(--border-radius);
            border-left: 4px solid;
        }

        .preview-image {
            max-width: 100%;
            max-height: 150px;
            border-radius: 8px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .form-control,
        .form-select {
            background: var(--bg-card);
            border: 1px solid rgba(0, 0, 0, 0.15);
            color: var(--text-primary);
            border-radius: 8px;
        }

        .form-control:focus,
        .form-select:focus {
            background: var(--bg-card);
            border-color: var(--accent-primary);
            color: var(--text-primary);
            box-shadow: 0 0 0 0.2rem rgba(59, 130, 246, 0.25);
        }

        .form-control::placeholder {
            color: var(--text-secondary);
        }

        .progress-custom {
            height: 6px;
            background: rgba(0, 0, 0, 0.1);
            border-radius: 3px;
        }

        .progress-bar-custom {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 3px;
        }

        @media (max-width: 768px) {
            .container-fluid {
                padding: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="main-header">        
            <!-- ä¸»é¡Œè¼¸å…¥å€å¡Š -->
            <div class="row mt-3">
                <div class="col">
                    <div class="mb-2">
                        <label for="theme-input" class="form-label fw-semibold text-dark">
                            <i class="bi bi-lightbulb text-primary"></i> ä¸»é¡Œ
                        </label>
                        <input type="text" class="form-control" id="theme-input" 
                               placeholder="è«‹è¼¸å…¥ä¸»é¡Œ..." 
                               value="è¬è¬é‡‘ä¸»å§Šå§Š">
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container-fluid">
        <div class="row g-4">
            <!-- Controls Panel -->
            <div class="col-lg-6">
                <div class="card card-custom h-100">
                    <div class="card-body">
                        <!-- <h5 class="card-title mb-4">
                            <i class="bi bi-sliders text-warning"></i> 
                            æ§åˆ¶é¢æ¿
                        </h5> -->

                        <!-- Upload Section -->
                        <div class="mb-4">
                            <label class="form-label fw-semibold">
                                <i class="bi bi-image text-primary"></i> ä¸Šå‚³åœ–ç‰‡
                            </label>
                            <div class="upload-zone d-flex flex-column justify-content-center align-items-center p-4" id="upload-zone">
                                <input type="file" id="image-upload" accept="image/*" class="d-none">
                                <div id="upload-content">
                                    <i class="bi bi-cloud-upload fs-1 text-muted mb-3"></i>
                                    <p class="mb-2 fw-semibold">é»æ“Šæˆ–æ‹–æ‹½ä¸Šå‚³åœ–ç‰‡</p>
                                    <p class="text-muted small mb-0">æ”¯æ´ JPG, PNG, GIF æ ¼å¼</p>
                                </div>
                                <div id="preview-container" class="d-none">
                                    <img id="preview-image" class="preview-image mb-2" alt="é è¦½åœ–ç‰‡">
                                    <p class="text-success small mb-0">
                                        <i class="bi bi-check-circle"></i> åœ–ç‰‡å·²ä¸Šå‚³
                                    </p>
                                </div>
                            </div>
                        </div>

                        <!-- Generate Button -->
                        <div class="d-grid">
                            <button class="btn btn-generate btn-lg" id="generate-btn">
                                <span class="btn-text">
                                    <i class="bi bi-magic"></i> 
                                    è‡ªå‹•ç”Ÿæˆåœ–ç‰‡
                                </span>
                                <span class="spinner-border spinner-border-custom d-none" id="loading-spinner"></span>
                            </button>
                        </div>

                        <!-- Progress Bar -->
                        <div class="progress progress-custom mt-3 d-none" id="progress-container">
                            <div class="progress-bar progress-bar-custom" id="progress-bar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Result Panel -->
            <div class="col-lg-6">
                <div class="card card-custom h-100">
                    <div class="card-body">
                        <h5 class="card-title mb-4">
                            <i class="bi bi-palette text-primary"></i> 
                            ç”Ÿæˆçµæœ
                        </h5>
                        
                        <div class="result-container d-flex justify-content-center align-items-center p-4" id="result-container">
                            <div class="text-center text-muted">
                                <i class="bi bi-image fs-1 mb-3 d-block"></i>
                                <p class="mb-0">ç”Ÿæˆçš„åœ–ç‰‡å°‡é¡¯ç¤ºåœ¨é€™è£¡</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Alert Container -->
        <div id="alert-container" class="mt-4"></div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        class BananaApp {
            constructor() {
                this.selectedFile = null;
                // Base64 ç·¨ç¢¼çš„ API Keyï¼Œä½¿ç”¨æ™‚æœƒè‡ªå‹•è§£ç¢¼
                this.encodedApiKey = 'c2stb3ItdjEtODU3ZjZlN2IyMjUxNWMxYzM0MGY3NzAyNjYzNDAzMWVmNGQ1ODlmODVlMTNlZjI4NjQ1YTFlYmE1YzI4MDhmNg==';
                this.apiKey = this.decodeApiKey();                
                this.initializeElements();
                this.initializeEventListeners();
            }

            decodeApiKey() {
                try {
                    // ä½¿ç”¨ atob å‡½æ•¸é€²è¡Œ base64 è§£ç¢¼
                    const decodedKey = atob(this.encodedApiKey);
                    console.log('API Key å·²æˆåŠŸè§£ç¢¼');
                    return decodedKey;
                } catch (error) {
                    console.error('API Key è§£ç¢¼å¤±æ•—:', error);
                    return '';
                }
            }

            initializeElements() {
                this.uploadZone = document.getElementById('upload-zone');
                this.fileInput = document.getElementById('image-upload');
                this.uploadContent = document.getElementById('upload-content');
                this.previewContainer = document.getElementById('preview-container');
                this.previewImage = document.getElementById('preview-image');
                this.generateBtn = document.getElementById('generate-btn');
                this.btnText = this.generateBtn.querySelector('.btn-text');
                this.loadingSpinner = document.getElementById('loading-spinner');
                this.resultContainer = document.getElementById('result-container');
                this.progressContainer = document.getElementById('progress-container');
                this.progressBar = document.getElementById('progress-bar');
                this.alertContainer = document.getElementById('alert-container');
                this.themeInput = document.getElementById('theme-input');
            }

            initializeEventListeners() {
                // æª”æ¡ˆä¸Šå‚³ç›¸é—œäº‹ä»¶
                this.uploadZone.addEventListener('click', () => {
                    this.fileInput.click();
                });

                ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                    this.uploadZone.addEventListener(eventName, this.preventDefaults.bind(this), false);
                });

                ['dragenter', 'dragover'].forEach(eventName => {
                    this.uploadZone.addEventListener(eventName, () => {
                        this.uploadZone.classList.add('drag-over');
                    });
                });

                ['dragleave', 'drop'].forEach(eventName => {
                    this.uploadZone.addEventListener(eventName, () => {
                        this.uploadZone.classList.remove('drag-over');
                    });
                });

                this.uploadZone.addEventListener('drop', (e) => {
                    const files = Array.from(e.dataTransfer.files).filter(file => file.type.startsWith('image/'));
                    if (files.length > 0) {
                        this.handleFile(files[0]);
                    }
                });

                this.fileInput.addEventListener('change', (e) => {
                    if (e.target.files.length > 0) {
                        this.handleFile(e.target.files[0]);
                    }
                });

                // ç”ŸæˆæŒ‰éˆ•äº‹ä»¶
                this.generateBtn.addEventListener('click', this.handleGenerate.bind(this));
            }

            preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            handleFile(file) {
                if (!file.type.startsWith('image/')) {
                    this.showAlert('è«‹é¸æ“‡æœ‰æ•ˆçš„åœ–ç‰‡æª”æ¡ˆ', 'warning');
                    return;
                }

                this.selectedFile = file;
                this.createPreview(file);
            }

            createPreview(file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    this.previewImage.src = e.target.result;
                    this.uploadContent.classList.add('d-none');
                    this.previewContainer.classList.remove('d-none');
                };
                reader.readAsDataURL(file);
            }

            async handleGenerate() {
                if (!this.selectedFile) {
                    this.showAlert('è«‹å…ˆä¸Šå‚³ä¸€å¼µåœ–ç‰‡', 'warning');
                    return;
                }

                // ç²å–ä¸»é¡Œè¼¸å…¥
                const theme = this.themeInput.value.trim() || 'è¬è¬é‡‘ä¸»å§Šå§Š';
                
                this.setLoading(true);
                this.clearAlerts();
                this.updateProgress(10);

                try {
                    // æº–å‚™åœ–ç‰‡æ•¸æ“š
                    this.updateProgress(30);
                    const base64Image = await this.fileToBase64(this.selectedFile);

                    // æ§‹å»ºåŒ…å«ä¸»é¡Œçš„æç¤ºè©
                    this.updateProgress(50);
                    const customPrompt = this.buildPromptWithTheme(theme);
                    const messages = this.buildMessages(customPrompt, base64Image);

                    // èª¿ç”¨ OpenRouter API
                    this.updateProgress(70);
                    const result = await this.callOpenRouter(messages);

                    // é¡¯ç¤ºçµæœ
                    this.updateProgress(90);
                    if (result.type === 'image') {
                        this.displayImage(result.content);
                        this.showAlert('åœ–ç‰‡ç”ŸæˆæˆåŠŸï¼', 'success');
                    } else {
                        this.displayText(result.content);
                        this.showAlert('å·²ç”Ÿæˆæ–‡å­—å›æ‡‰', 'info');
                    }

                    this.updateProgress(100);

                } catch (error) {
                    console.error('ç”Ÿæˆå¤±æ•—:', error);
                    this.showAlert(`ç”Ÿæˆå¤±æ•—: ${error.message}`, 'danger');
                } finally {
                    setTimeout(() => {
                        this.setLoading(false);
                        this.hideProgress();
                    }, 500);
                }
            }

            buildMessages(prompt, base64Image) {
                const content = [
                    { type: "text", text: prompt },
                    { type: "image_url", image_url: { url: base64Image } }
                ];

                return [{ role: "user", content }];
            }

            buildPromptWithTheme(theme) {
                return `æ ¹æ“šä»¥ä¸‹ä¸»é¡Œ/å ´æ™¯/é™åˆ¶çš„æè¿°,ä¸€å®šç¢ºå¯¦åœ°å¹«æˆ‘è¼¸å‡ºåœ–ç‰‡,ä¸è¦å›è¦†æ–‡å­—å…§å®¹
ä¸»é¡Œ:${theme}
å ´æ™¯:
1.åŸåœ–ä¸­æ‰€æœ‰äººç‰©éƒ½ä¸€å®šå¿…é ˆä»¥è¶…å¯«å¯¦çš„1/6æ¯”ä¾‹æˆç‚ºä¸»é«”ï¼Œå…¶å§¿å‹¢å’Œè¿‘è·é›¢ç‰©å“èˆ‡åŸåœ–ä¸€è‡´ï¼Œæœ€çµ‚è¢«è¨­è¨ˆæˆæˆå“ï¼Œæ“ºæ”¾åœ¨é›»è…¦æ¡Œä¸Šã€‚
2.ä¸»é«”ç«‹æ–¼ä¸€å€‹ä¹¾æ·¨ã€åœ“å½¢ã€é€æ˜çš„å£“å…‹åŠ›åº•åº§ä¸Šï¼Œåº•åº§ä¸Šæ²’æœ‰ä»»ä½•æ¨™ç±¤æˆ–æ–‡å­—ã€‚å°ˆæ¥­çš„å·¥ä½œå®¤ç‡ˆå…‰çªé¡¯äº†é›•å¡‘çš„ç´°ç¯€ã€‚
3.èƒŒæ™¯ä¸­çš„iMacè¢å¹•é¡¯ç¤ºè‘—ä¸»é«”äººå¶çš„ZBrushå»ºæ¨¡éç¨‹ï¼Œä¸å¡«è‰²ä»¥å‡¸é¡¯äº†ã€Œé€²è¡Œä¸­ã€èˆ‡æˆå“ä¹‹é–“çš„å°æ¯”ã€‚
4.äººå¶æ—é‚Šæ˜¯ä¸€å€‹åŒ…è£ç›’ï¼Œå¸¶æœ‰é€æ˜çª—å£ï¼Œä¸¦è²¼æœ‰ç¬¦åˆä¸»é¡Œåç¨±çš„ä¸­æ–‡ç¹é«”å­—è²¼ç´™ã€‚ç›’å­é ‚éƒ¨æ•é–‹ï¼Œåƒ…éœ²å‡ºä¸€å€‹é€æ˜çš„å¡‘è† è“‹ã€‚ç›’å­çš„é«˜åº¦ç•¥é«˜æ–¼äººå¶æœ¬èº«ï¼Œä½†å°ºå¯¸èˆ‡æ¨¡å‹çš„å¯¦éš›å°ºå¯¸ç›¸ç¬¦ã€‚
é™åˆ¶:
å‘¨åœä½ˆç½®ä¸Šç›¸ç•¶è±å¯Œç¬¦åˆä¸»é¡Œçš„è£é£¾ç‰©å“`;
            }

            async callOpenRouter(messages) {
                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${this.apiKey}`,
                        "Content-Type": "application/json",
                        "HTTP-Referer": window.location.origin,
                        "X-Title": "Banana Image Generator"
                    },
                    body: JSON.stringify({
                        model: "google/gemini-2.5-flash-image-preview",
                        messages: messages,
                        max_tokens: 10000,
                        temperature: 0.2
                    })
                });

                if (!response.ok) {
                    const errorBody = await response.text();
                    throw new Error(`API éŒ¯èª¤: ${response.status} ${response.statusText}`);
                }

                const responseData = await response.json();
                console.log('OpenRouter Response:', responseData);

                const message = responseData.choices?.[0]?.message;

                // æª¢æŸ¥åœ–ç‰‡å›æ‡‰
                if (message?.images?.[0]?.image_url?.url) {
                    return { type: 'image', content: message.images[0].image_url.url };
                }

                if (typeof message?.content === 'string' && message.content.startsWith('data:image/')) {
                    return { type: 'image', content: message.content };
                }

                // æª¢æŸ¥æ–‡å­—å›æ‡‰
                if (typeof message?.content === 'string' && message.content.trim() !== '') {
                    return { type: 'text', content: message.content };
                }

                return { type: 'text', content: "[æ¨¡å‹æ²’æœ‰è¿”å›æœ‰æ•ˆå…§å®¹]" };
            }

            fileToBase64(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = reject;
                    reader.readAsDataURL(file);
                });
            }

            setLoading(isLoading) {
                this.generateBtn.disabled = isLoading;
                if (isLoading) {
                    this.btnText.classList.add('d-none');
                    this.loadingSpinner.classList.remove('d-none');
                    this.showProgress();
                } else {
                    this.btnText.classList.remove('d-none');
                    this.loadingSpinner.classList.add('d-none');
                }
            }

            showProgress() {
                this.progressContainer.classList.remove('d-none');
            }

            hideProgress() {
                this.progressContainer.classList.add('d-none');
                this.updateProgress(0);
            }

            updateProgress(percent) {
                this.progressBar.style.width = `${percent}%`;
            }

            displayImage(imageUrl) {
                this.resultContainer.innerHTML = '';
                const img = document.createElement('img');
                img.src = imageUrl;
                img.alt = 'ç”Ÿæˆçš„åœ–ç‰‡';
                img.className = 'img-fluid';
                img.style.cssText = 'max-width: 100%; height: auto; border-radius: 12px; box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3); cursor: pointer;';
                
                // æ·»åŠ é»æ“Šä¸‹è¼‰åŠŸèƒ½
                img.addEventListener('click', () => {
                    this.downloadImage(imageUrl);
                });
                
                // æ·»åŠ æç¤ºæ–‡å­—
                const downloadHint = document.createElement('p');
                downloadHint.className = 'text-center text-muted small mt-2 mb-0';
                downloadHint.innerHTML = '<i class="bi bi-download"></i> é»æ“Šåœ–ç‰‡å³å¯ä¸‹è¼‰';
                
                img.onload = () => {
                    this.resultContainer.appendChild(img);
                    this.resultContainer.appendChild(downloadHint);
                    
                    // è‡ªå‹•æ»¾å‹•åˆ°çµæœå€å¡Š
                    this.scrollToResult();
                };
                
                img.onerror = () => {
                    this.resultContainer.innerHTML = `
                        <div class="text-center text-danger">
                            <i class="bi bi-exclamation-triangle fs-1 mb-3 d-block"></i>
                            <p class="mb-0">åœ–ç‰‡è¼‰å…¥å¤±æ•—</p>
                        </div>
                    `;
                };
            }

            displayText(text) {
                this.resultContainer.innerHTML = `
                    <div class="w-100">
                        <div class="alert alert-info border-0">
                            <h6 class="alert-heading">
                                <i class="bi bi-info-circle"></i> å›æ‡‰å…§å®¹
                            </h6>
                            <p class="mb-0" style="white-space: pre-wrap; word-break: break-word;">${text}</p>
                        </div>
                    </div>
                `;
                
                // è‡ªå‹•æ»¾å‹•åˆ°çµæœå€å¡Š
                this.scrollToResult();
            }

            showAlert(message, type = 'info') {
                const alertId = 'alert-' + Date.now();
                const alertHTML = `
                    <div id="${alertId}" class="alert alert-${type} alert-custom alert-dismissible fade show" role="alert">
                        <i class="bi bi-${this.getAlertIcon(type)}"></i>
                        ${message}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                `;
                
                this.alertContainer.innerHTML = alertHTML;
                
                // è‡ªå‹•ç§»é™¤ alert
                setTimeout(() => {
                    const alertElement = document.getElementById(alertId);
                    if (alertElement) {
                        const alert = new bootstrap.Alert(alertElement);
                        alert.close();
                    }
                }, 5000);
            }

            getAlertIcon(type) {
                const icons = {
                    success: 'check-circle',
                    danger: 'exclamation-triangle',
                    warning: 'exclamation-triangle',
                    info: 'info-circle'
                };
                return icons[type] || 'info-circle';
            }

            clearAlerts() {
                this.alertContainer.innerHTML = '';
            }

            async downloadImage(imageUrl) {
                try {
                    this.showAlert('æ­£åœ¨æº–å‚™ä¸‹è¼‰...', 'info');
                    
                    // å¦‚æœæ˜¯ data URLï¼Œç›´æ¥ä¸‹è¼‰
                    if (imageUrl.startsWith('data:')) {
                        this.downloadDataUrl(imageUrl);
                        return;
                    }
                    
                    // å¦‚æœæ˜¯å¤–éƒ¨ URLï¼Œéœ€è¦å…ˆç²å–åœ–ç‰‡æ•¸æ“š
                    const response = await fetch(imageUrl);
                    if (!response.ok) {
                        throw new Error('ç„¡æ³•ç²å–åœ–ç‰‡æ•¸æ“š');
                    }
                    
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    
                    // å‰µå»ºä¸‹è¼‰é€£çµ
                    const link = document.createElement('a');
                    link.href = url;
                    link.download = `banana-generated-${Date.now()}.png`;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                    // æ¸…ç† URL
                    window.URL.revokeObjectURL(url);
                    
                    this.showAlert('åœ–ç‰‡ä¸‹è¼‰æˆåŠŸï¼', 'success');
                    
                } catch (error) {
                    console.error('ä¸‹è¼‰å¤±æ•—:', error);
                    this.showAlert('ä¸‹è¼‰å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦', 'danger');
                }
            }

            downloadDataUrl(dataUrl) {
                // å¾ data URL ç²å–æª”æ¡ˆé¡å‹
                const mimeMatch = dataUrl.match(/data:([^;]+);/);
                const mimeType = mimeMatch ? mimeMatch[1] : 'image/png';
                const extension = mimeType.split('/')[1] || 'png';
                
                // å‰µå»ºä¸‹è¼‰é€£çµ
                const link = document.createElement('a');
                link.href = dataUrl;
                link.download = `banana-generated-${Date.now()}.${extension}`;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                
                this.showAlert('åœ–ç‰‡ä¸‹è¼‰æˆåŠŸï¼', 'success');
            }

            scrollToResult() {
                // å¹³æ»‘æ»¾å‹•åˆ°çµæœå€å¡Š
                this.resultContainer.scrollIntoView({
                    behavior: 'smooth',
                    block: 'center'
                });
            }
        }

        // åˆå§‹åŒ–æ‡‰ç”¨
        document.addEventListener('DOMContentLoaded', () => {
            new BananaApp();
        });

        // å…¨åŸŸéŒ¯èª¤è™•ç†
        window.addEventListener('error', (e) => {
            console.error('å…¨åŸŸéŒ¯èª¤:', e.error);
        });

        window.addEventListener('unhandledrejection', (e) => {
            console.error('æœªè™•ç†çš„ Promise æ‹’çµ•:', e.reason);
        });
    </script>
</body>
</html>
